<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amirhosein & Abolfazl Professional Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Vazirmatn', 'Tahoma', 'Segoe UI', 'sans-serif'],
                        mono: ['Tahoma', 'sans-serif'],
                    },
                    colors: {
                        honey: '#EBA937', /* Ø±Ù†Ú¯ Ø¹Ø³Ù„ÛŒ */
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            /* ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ù‡ Ø³ÙÛŒØ¯/Ø·ÙˆØ³ÛŒ Ø±ÙˆØ´Ù† Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù‡ Ø´Ø¯Ù† Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ */
            background-color: #ecf0f3;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            transition: background 0.5s ease;
            color: #444;
        }

        /* DARK MODE */
        body.dark-mode {
            background-color: #1e293b;
            color: #e2e8f0;
        }

        /* --- STYLES FOR SHADOWS (NEUMORPHISM) --- */
        
        /* Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¬Ø³ØªÙ‡ Ø´Ø¯Ù†Ø¯ */
        .glass-panel {
            background: #ecf0f3;
            border-radius: 40px;
            /* Ø³Ø§ÛŒÙ‡ Ø¨Ø±Ø¬Ø³ØªÙ‡ Ø´Ø¨ÛŒÙ‡ ØªØµÙˆÛŒØ± Ø§Ø±Ø³Ø§Ù„ÛŒ */
            box-shadow: 14px 14px 28px #cbced1, 
                       -14px -14px 28px #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }

        body.dark-mode .glass-panel {
            background: #1e293b;
            box-shadow: 10px 10px 20px #151d29, 
                       -10px -10px 20px #27354d;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ - Ø¨Ø±Ø¬Ø³ØªÙ‡ Ùˆ Ù†Ø±Ù… */
        .btn-bubble {
            background: #ecf0f3;
            border-radius: 50%; /* Ø§Ú¯Ø± Ù…Ø±Ø¨Ø¹ Ù…ÛŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ Ø§Ù…Ø§ Ú¯Ø±Ø¯ Ù‚Ø´Ù†Ú¯ØªØ± Ø§Ø³Øª */
            box-shadow: 6px 6px 10px #cbced1, 
                       -6px -6px 10px #ffffff;
            color: #444;
            font-family: 'Tahoma', 'Vazirmatn', sans-serif;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }

        body.dark-mode .btn-bubble {
            background: #1e293b;
            box-shadow: 6px 6px 10px #151d29, 
                       -6px -6px 10px #27354d;
            color: #e2e8f0;
        }

        /* Ø­Ø§Ù„Øª ÙØ´Ø±Ø¯Ù‡ Ø´Ø¯Ù† Ø¯Ú©Ù…Ù‡ (Inset Shadow) */
        .btn-bubble:active, .btn-bubble.active {
            box-shadow: inset 6px 6px 10px #cbced1, 
                       inset -6px -6px 10px #ffffff;
            transform: scale(0.98);
        }

        body.dark-mode .btn-bubble:active {
            box-shadow: inset 6px 6px 10px #151d29, 
                       inset -6px -6px 10px #27354d;
        }

        /* Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn-op { color: #d63031; } /* Ù‚Ø±Ù…Ø² Ù…Ù„Ø§ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª */
        .btn-eq { 
            background: #EBA937 !important; /* Ø±Ù†Ú¯ Ø¹Ø³Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø³Ø§ÙˆÛŒ */
            color: white !important;
            box-shadow: 6px 6px 10px #b8852b, 
                       -6px -6px 10px #ffcd43;
        }
        .btn-eq:active {
            box-shadow: inset 4px 4px 8px #b8852b, 
                       inset -4px -4px 8px #ffcd43;
        }
        
        .btn-ac { color: #e17055; }
        .btn-func { color: #0984e3; }

        /* ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ (Input) - Ø­Ø§Ù„Øª ÙØ±Ùˆ Ø±ÙØªÙ‡ */
        .glass-input {
            background: #ecf0f3;
            border: none;
            border-radius: 15px;
            padding: 10px;
            box-shadow: inset 6px 6px 10px #cbced1, 
                       inset -6px -6px 10px #ffffff;
            color: #444;
            outline: none;
            transition: all 0.3s;
            font-family: 'Tahoma', sans-serif;
        }

        body.dark-mode .glass-input {
            background: #1e293b;
            color: #fff;
            box-shadow: inset 6px 6px 10px #151d29, 
                       inset -6px -6px 10px #27354d;
        }
        
        .glass-input:focus {
            box-shadow: inset 3px 3px 5px #cbced1, 
                       inset -3px -3px 5px #ffffff;
        }

        /* Tab Buttons */
        .nav-pill {
            background: transparent;
            border-radius: 20px;
            color: #666;
            transition: all 0.3s;
        }
        .nav-pill.active {
            background: #ecf0f3;
            color: #EBA937; /* Honey Color Text */
            box-shadow: 6px 6px 10px #cbced1, 
                       -6px -6px 10px #ffffff;
            font-weight: 800;
        }
        body.dark-mode .nav-pill.active {
            background: #1e293b;
            box-shadow: 6px 6px 10px #151d29, 
                       -6px -6px 10px #27354d;
        }

        /* --- INTRO & LOGIN SCREEN UPDATES --- */
        
        /* ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø§ÛŒÙ†ØªØ±Ùˆ Ø¨Ù‡ Ø±Ù†Ú¯ Ø¹Ø³Ù„ÛŒ */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #EBA937; /* Ø±Ù†Ú¯ Ø¹Ø³Ù„ÛŒ */
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.2s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        
        /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ù‡Ù… Ø¹Ø³Ù„ÛŒ */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #EBA937; /* Ø±Ù†Ú¯ Ø¹Ø³Ù„ÛŒ */
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }

        .intro-text-style {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-weight: 800;
            color: #fff; /* Ù…ØªÙ† Ø³ÙÛŒØ¯ Ø±ÙˆÛŒ Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ø¹Ø³Ù„ÛŒ */
            letter-spacing: -1px;
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.5s cubic-bezier(0.22, 1, 0.36, 1); 
            text-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #intro-hello { font-size: 5rem; margin-bottom: 0.5rem; }
        #intro-sub { font-size: 1.5rem; font-weight: 500; color: #fff; }
        #intro-special-msg { font-size: 1.5rem; font-weight: 700; color: #fff; text-align: center; }

        /* Menu Button */
        .glass-menu-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            background: #ecf0f3;
            box-shadow: 6px 6px 10px #cbced1, -6px -6px 10px #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }
        body.dark-mode .glass-menu-btn {
            background: #1e293b;
            box-shadow: 6px 6px 10px #151d29, -6px -6px 10px #27354d;
        }
        .glass-menu-btn:hover { transform: scale(1.05); }

        .dot { width: 5px; height: 5px; background-color: #444; border-radius: 50%; }
        body.dark-mode .dot { background-color: #fff; }

        /* Menu Dropdown */
        .menu-dropdown {
            position: fixed;
            top: 80px;
            left: 20px;
            width: 220px;
            background: #ecf0f3;
            box-shadow: 10px 10px 20px #cbced1, -10px -10px 20px #ffffff;
            border-radius: 20px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-20px);
            transition: all 0.3s;
            z-index: 99;
        }
        body.dark-mode .menu-dropdown {
            background: #1e293b;
            box-shadow: 10px 10px 20px #151d29, -10px -10px 20px #27354d;
        }
        .menu-dropdown.show { opacity: 1; visibility: visible; transform: translateY(0); }

        .menu-item {
            padding: 10px 15px;
            border-radius: 12px;
            cursor: pointer;
            color: #333;
            font-weight: 600;
            transition: background 0.2s;
        }
        body.dark-mode .menu-item { color: #e2e8f0; }
        .menu-item:hover { background: rgba(0,0,0,0.05); }
        body.dark-mode .menu-item:hover { background: rgba(255,255,255,0.05); }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        .modal-content {
            width: 90%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: all 0.3s;
        }
        .modal-overlay.open .modal-content { transform: scale(1); }

        /* Toast */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            z-index: 300;
            transition: transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        #user-name-badge {
            position: absolute;
            top: 5px;
            right: 15px;
            font-size: 0.85rem;
            font-weight: 700;
            color: #444;
            padding: 8px 16px;
            border-radius: 20px;
            background: #ecf0f3;
            box-shadow: 5px 5px 10px #cbced1, -5px -5px 10px #ffffff;
            z-index: 50;
        }
        body.dark-mode #user-name-badge {
            color: #e2e8f0;
            background: #1e293b;
            box-shadow: 5px 5px 10px #151d29, -5px -5px 10px #27354d;
        }
    </style>
</head>
<body class="selection:bg-yellow-200 selection:text-gray-900 transition-colors duration-500">

    <div id="login-overlay">
        <div class="glass-panel p-8 rounded-[2rem] flex flex-col gap-5 w-80 text-center shadow-2xl bg-[#ecf0f3]">
            <h2 class="text-2xl font-bold font-sans mb-2 text-gray-800">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
            <div class="flex flex-col gap-4">
                <input type="text" id="login-fname" class="glass-input w-full h-12 rounded-xl text-center text-lg placeholder-gray-500" placeholder="Ù†Ø§Ù…">
                <input type="text" id="login-lname" class="glass-input w-full h-12 rounded-xl text-center text-lg placeholder-gray-500" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
            </div>
            <button onclick="submitLogin()" class="btn-bubble w-full h-12 rounded-xl text-black font-bold text-lg mt-2 hover:bg-gray-200 transition-all">ÙˆØ±ÙˆØ¯</button>
        </div>
    </div>

    <div id="intro-overlay">
        <div id="intro-special-msg" class="intro-text-style hidden"></div>
        <div id="intro-hello" class="intro-text-style">Hello</div>
        <div id="intro-sub" class="intro-text-style">Amirhosein And Abolfazl pro calculator</div>
    </div>

    <div id="toast">Ù…ØªÙ† Ù¾ÛŒØ§Ù…</div>

    <div id="main-app-container" class="app-container w-full h-full flex flex-col items-center justify-center relative opacity-0 transition-opacity duration-1000">
        
        <div id="user-name-badge" class="hidden"></div>

        <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
            <div class="absolute top-10 left-10 w-72 h-72 bg-gray-200/50 rounded-full filter blur-3xl opacity-60 animate-blob dark:bg-gray-700/30"></div>
            <div class="absolute top-10 right-10 w-72 h-72 bg-gray-300/50 rounded-full filter blur-3xl opacity-60 animate-blob animation-delay-2000 dark:bg-gray-800/30"></div>
            <div class="absolute -bottom-32 left-20 w-72 h-72 bg-yellow-100/50 rounded-full filter blur-3xl opacity-40 animate-blob animation-delay-4000 dark:bg-gray-900/30"></div>
        </div>

        <div class="glass-menu-btn" onclick="toggleMenu()">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>

        <div id="main-menu" class="menu-dropdown">
            <div class="menu-item" onclick="openSettings()">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</div>
            <div class="menu-item" onclick="openHistory()">ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡</div>
            <div class="menu-item" onclick="openConverter()">ğŸ”„ ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯</div>
            <div class="menu-item" onclick="openCurrency()">ğŸ’± ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</div>
            <div class="menu-item" onclick="openDiscount()">ğŸ·ï¸ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ®ÙÛŒÙ</div>
            <div class="menu-item" onclick="openBMI()">ğŸ’ª Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ</div>
            <div class="menu-item" onclick="openPower()">âš¡ ØªÙˆØ§Ù†</div>
            <div class="menu-item" onclick="openAgeCalc()">ğŸ“… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù† Ø¯Ù‚ÛŒÙ‚</div>
        </div>

        <div id="settings-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('settings-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-6 text-gray-800 dark:text-white">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
                
                <div id="settings-content-wrapper" class="flex flex-col gap-6">
                    <div class="glass-input rounded-xl p-4 flex flex-col items-center gap-2">
                        <div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center text-3xl shadow-inner">ğŸ‘¤</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ</div>
                        <div id="settings-user-name" class="text-lg font-bold text-gray-800 dark:text-white">---</div>
                    </div>

                    <div class="glass-input rounded-xl p-4 flex items-center justify-between cursor-pointer" onclick="toggleTheme()">
                        <span class="text-gray-700 dark:text-gray-200 font-semibold">Ø­Ø§Ù„Øª Ø´Ø¨ (Dark Mode)</span>
                        <div class="relative w-12 h-6 rounded-full bg-gray-300 dark:bg-green-600 transition-colors shadow-inner">
                            <div class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform transform dark:translate-x-6 shadow"></div>
                        </div>
                    </div>

                    <div class="mt-4 pt-4 border-t border-gray-300 dark:border-gray-700 text-center">
                        <p class="text-sm text-gray-800 dark:text-gray-200 font-bold mb-1">ØªÙ‡ÛŒÙ‡ Ú©Ù†Ù†Ø¯Ù‡ Ùˆ Ú©Ø¯ Ù†ÙˆÛŒØ³ = Ø§Ù…ÛŒØ± Ø­Ø³ÛŒÙ† Ù†Ø§Ø¯Ø±ÛŒ</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 font-semibold">Ø¯Ø³ØªÛŒØ§Ø± Ú©Ø¯ Ù†ÙˆÛŒØ³ Ùˆ Ø§Ø³Ù¾Ø§Ù†Ø³Ø± = Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„ Ø­Ø¶Ø±ØªÛŒ Ø²Ø§Ø¯Ù‡</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="history-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('history-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª</h2>
                <div id="history-list" class="flex flex-col gap-2 overflow-y-auto max-h-[60vh] pr-1"></div>
                <button onclick="clearHistory()" class="btn-bubble mt-4 py-2 rounded-xl text-red-700 text-sm font-semibold">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
            </div>
        </div>

        <div id="converter-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('converter-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯</h2>
                <div class="flex flex-col gap-4">
                    <select id="conv-type" onchange="updateConvOptions()" class="glass-input w-full h-10 rounded-xl text-center cursor-pointer">
                        <option value="length">Ø·ÙˆÙ„</option>
                        <option value="mass">ÙˆØ²Ù† (Ø¬Ø±Ù…)</option>
                        <option value="temp">Ø¯Ù…Ø§</option>
                    </select>
                    <input type="number" id="conv-input" oninput="convertUnits()" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono" placeholder="0">
                    <div class="flex gap-2 items-center">
                        <select id="conv-from" onchange="convertUnits()" class="glass-input flex-1 h-12 rounded-xl text-center cursor-pointer"></select>
                        <span class="text-gray-500 font-bold">Ø¨Ù‡</span>
                        <select id="conv-to" onchange="convertUnits()" class="glass-input flex-1 h-12 rounded-xl text-center cursor-pointer"></select>
                    </div>
                    <div class="glass-input rounded-xl p-4 mt-2 text-center">
                        <div id="conv-result" class="text-2xl font-mono font-bold text-gray-800 dark:text-white">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="currency-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('currency-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</h2>
                <div class="flex flex-col gap-4">
                    <label class="text-xs text-gray-500 mr-2">Ù‚ÛŒÙ…Øª Û± Ø¯Ù„Ø§Ø± (ØªÙˆÙ…Ø§Ù†):</label>
                    <input type="number" id="curr-rate" class="glass-input w-full h-10 rounded-xl text-center font-mono" value="70000" oninput="calcCurrency()">
                    <div class="glass-input p-1 rounded-full flex gap-1 bg-transparent shadow-none border-none">
                        <button onclick="setCurrMode('usd-to-irr')" id="btn-usd-irr" class="flex-1 py-2 rounded-full text-xs font-semibold shadow-inner bg-gray-200 text-gray-800">Ø¯Ù„Ø§Ø± Ø¨Ù‡ ØªÙˆÙ…Ø§Ù†</button>
                        <button onclick="setCurrMode('irr-to-usd')" id="btn-irr-usd" class="flex-1 py-2 rounded-full text-xs font-semibold text-gray-500">ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø¯Ù„Ø§Ø±</button>
                    </div>
                    <input type="number" id="curr-input" oninput="calcCurrency()" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono" placeholder="0">
                    <div class="glass-input rounded-xl p-4 mt-2 text-center">
                         <div id="curr-result" class="text-2xl font-mono font-bold text-gray-800 dark:text-white">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="discount-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('discount-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ®ÙÛŒÙ</h2>
                <div class="flex flex-col gap-4">
                    <input type="number" id="disc-price" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono" placeholder="Ù‚ÛŒÙ…Øª Ø§ØµÙ„ÛŒ">
                    <input type="number" id="disc-percent" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono" placeholder="Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ">
                    <button onclick="calcDiscount()" class="btn-bubble btn-eq h-12 rounded-xl text-lg font-semibold">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    <div id="disc-result" class="glass-input rounded-xl p-4 mt-2 text-center text-gray-800 dark:text-white font-mono dir-ltr">---</div>
                </div>
            </div>
        </div>

        <div id="bmi-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('bmi-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">BMI</h2>
                <div class="flex flex-col gap-4">
                    <input type="number" id="bmi-height" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono" placeholder="Ù‚Ø¯ (cm)">
                    <input type="number" id="bmi-weight" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono" placeholder="ÙˆØ²Ù† (kg)">
                    <button onclick="calcBMI()" class="btn-bubble btn-eq h-12 rounded-xl text-lg font-semibold">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    <div id="bmi-result" class="glass-input rounded-xl p-4 mt-2 text-center text-gray-800 dark:text-white">---</div>
                </div>
            </div>
        </div>

        <div id="power-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('power-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÙˆØ§Ù†</h2>
                <div class="flex flex-col gap-2">
                    <div class="flex gap-2">
                        <input type="number" id="pow-base" class="glass-input w-full h-10 rounded-xl text-center font-mono" placeholder="Ù¾Ø§ÛŒÙ‡">
                        <input type="number" id="pow-exp" class="glass-input w-full h-10 rounded-xl text-center font-mono" placeholder="ØªÙˆØ§Ù†">
                    </div>
                    <button onclick="calcPower()" class="btn-bubble btn-op h-10 rounded-xl w-full mt-2">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    <div id="pow-result" class="text-center font-bold text-lg font-mono text-gray-800 dark:text-white mt-2">---</div>
                </div>
            </div>
        </div>

        <div id="age-modal" class="modal-overlay">
            <div class="modal-content glass-panel rounded-[2rem] p-6 flex flex-col relative">
                <button onclick="closeModal('age-modal')" class="absolute top-4 left-4 text-gray-600 hover:text-red-500 font-bold text-xl transition-colors dark:text-gray-300">âœ•</button>
                <h2 class="text-xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù† Ø¯Ù‚ÛŒÙ‚</h2>
                <div class="flex flex-col gap-4">
                    <input type="date" id="age-input" class="glass-input w-full h-12 rounded-xl text-center text-lg font-mono">
                    <button onclick="calcAge()" class="btn-bubble btn-eq h-12 rounded-xl text-lg font-semibold">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    <div id="age-result" class="glass-input rounded-xl p-4 mt-2 text-center text-gray-800 dark:text-white flex flex-col gap-2">---</div>
                </div>
            </div>
        </div>

        <header class="mb-6 animate-float mt-10">
            <div class="glass-panel rounded-full px-8 py-3 text-center">
                <h1 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-100 tracking-tight drop-shadow-sm">
                    Amirhosein <span class="text-honey dark:text-yellow-500">&</span> Abolfazl
                </h1>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-semibold uppercase tracking-widest mt-1 opacity-90">Ultra Hyper Calculator</p>
            </div>
        </header>

        <main class="w-full max-w-md px-4 pb-10">
            <div class="glass-panel rounded-[3rem] p-6 relative overflow-hidden min-h-[600px] flex flex-col">
                
                <div class="glass-input rounded-full p-1.5 flex justify-between items-center mb-6" style="box-shadow: inset 4px 4px 8px #cbced1, inset -4px -4px 8px #ffffff;">
                    <button onclick="switchTab('basic')" id="tab-basic" class="nav-pill active flex-1 py-2 rounded-full text-[10px] sm:text-xs font-semibold">Ù¾Ø§ÛŒÙ‡</button>
                    <button onclick="switchTab('fraction')" id="tab-fraction" class="nav-pill flex-1 py-2 rounded-full text-[10px] sm:text-xs font-semibold">Ú©Ø³Ø±</button>
                    <button onclick="switchTab('equation')" id="tab-equation" class="nav-pill flex-1 py-2 rounded-full text-[10px] sm:text-xs font-semibold">Ù…Ø¹Ø§Ø¯Ù„Ù‡</button>
                    <button onclick="switchTab('number')" id="tab-number" class="nav-pill flex-1 py-2 rounded-full text-[10px] sm:text-xs font-semibold">Ø¹Ø¯Ø¯</button>
                    <button onclick="switchTab('polygon')" id="tab-polygon" class="nav-pill flex-1 py-2 rounded-full text-[10px] sm:text-xs font-semibold">Ú†Ù†Ø¯Ø¶Ù„Ø¹ÛŒ</button>
                    <button onclick="switchTab('sieve')" id="tab-sieve" class="nav-pill flex-1 py-2 rounded-full text-[10px] sm:text-xs font-semibold">ØºØ±Ø¨Ø§Ù„</button>
                </div>

                <div id="app-content" class="flex-1 flex flex-col relative transition-opacity duration-300">
                </div>

            </div>
        </main>
    </div>

    <script>
        // --- State Management ---
        let currentTab = 'basic';
        let displayVal = '0';
        let calcHistory = [];
        let isDarkMode = false;
        let userData = { firstName: '', lastName: '' };

        // --- INIT & FLOW ---
        document.addEventListener('DOMContentLoaded', () => {
            updateConvOptions();
            const savedFName = localStorage.getItem('ah_user_fname');
            const savedLName = localStorage.getItem('ah_user_lname');

            if (savedFName && savedLName) {
                userData.firstName = savedFName;
                userData.lastName = savedLName;
                document.getElementById('login-overlay').style.display = 'none';
                startIntroSequence();
            }
            renderBasic();
        });

        // --- LOGIN LOGIC ---
        function submitLogin() {
            const fName = document.getElementById('login-fname').value.trim();
            const lName = document.getElementById('login-lname').value.trim();
            if (!fName || !lName) { showToast('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }

            localStorage.setItem('ah_user_fname', fName);
            localStorage.setItem('ah_user_lname', lName);
            userData.firstName = fName;
            userData.lastName = lName;

            const loginOverlay = document.getElementById('login-overlay');
            loginOverlay.style.opacity = '0';
            setTimeout(() => {
                loginOverlay.style.display = 'none';
                startIntroSequence();
            }, 1000);
        }

        // --- INTRO SEQUENCE ---
        function startIntroSequence() {
            const overlay = document.getElementById('intro-overlay');
            const helloText = document.getElementById('intro-hello');
            const subText = document.getElementById('intro-sub');
            const specialMsg = document.getElementById('intro-special-msg');
            const mainApp = document.getElementById('main-app-container');
            const userBadge = document.getElementById('user-name-badge');

            // Special Teachers Check
            const specialTeachers = [
                { f: 'Ø­Ø§Ù…Ø¯', l: 'Ù…ÙˆÙ„Ø§ÛŒÛŒ' }, { f: 'Ø­Ø³ÛŒÙ†', l: 'Ø¨Ø®ØªÛŒØ§Ø±ÛŒ' },
                { f: 'Ù…Ø­Ù…Ø¯', l: 'Ù‚Ø§Ø³Ù…ÛŒ' }, { f: 'Ù…ØµØ·ÙÛŒ', l: 'Ø´Ø¹Ø¨Ø§Ù†ÛŒ' }
            ];
            const foundTeacher = specialTeachers.find(t => t.f === userData.firstName.trim() && t.l === userData.lastName.trim());
            userBadge.innerText = foundTeacher ? `Ø§Ø³ØªØ§Ø¯ ${userData.lastName} Ø¹Ø²ÛŒØ²` : `${userData.firstName} Ø¹Ø²ÛŒØ²`;
            userBadge.classList.remove('hidden');

            overlay.classList.add('active'); // Hidden initially in CSS, this ensures it's prepped (though display block handles it)
            overlay.style.opacity = '1';
            overlay.style.pointerEvents = 'auto';

            const f = userData.firstName.trim();
            const l = userData.lastName.trim();
            const isAbolfazl = f.includes('Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„') || f.toLowerCase().includes('abolfazl');
            const isHazrati = l.includes('Ø­Ø¶Ø±ØªÛŒ') || l.toLowerCase().includes('hazrati');

            if (isAbolfazl && isHazrati) {
                specialMsg.innerHTML = 'Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ø¯Ø± Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§ÙˆÙ„ Ø´ÛŒÙ… Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„ Ø­Ø¶Ø±ØªÛŒ Ø¹Ø²ÛŒØ² Ù…Ù…Ù†ÙˆÙ† Ú©Ù‡ Ù¾Ø§ Ø¨Ù‡ Ù¾Ø§Ù… ØªÙ„Ø§Ø´ Ú©Ø±Ø¯ÛŒ ØªØ§ Ø§ÛŒÙ† Ø±Ùˆ Ø¨Ù‡ Ø§ÛŒÙ† Ø¯Ø±Ø¬Ù‡ Ø¨Ø±Ø³ÙˆÙ†ÛŒÙ…';
                specialMsg.classList.remove('hidden');
                setTimeout(() => { specialMsg.style.opacity = '1'; specialMsg.style.transform = 'translateY(0)'; }, 300);
                setTimeout(() => { helloText.style.opacity = '1'; helloText.style.transform = 'translateY(0)'; }, 2000);
                setTimeout(() => { subText.style.opacity = '1'; subText.style.transform = 'translateY(0)'; }, 3000);
                setTimeout(() => { overlay.style.opacity = '0'; mainApp.classList.add('app-visible'); mainApp.style.opacity = '1'; setTimeout(() => { overlay.style.display = 'none'; }, 1200); }, 6000);
            } else {
                setTimeout(() => { helloText.style.opacity = '1'; helloText.style.transform = 'translateY(0)'; }, 300);
                setTimeout(() => { subText.style.opacity = '1'; subText.style.transform = 'translateY(0)'; }, 1200);
                setTimeout(() => { overlay.style.opacity = '0'; mainApp.classList.add('app-visible'); mainApp.style.opacity = '1'; setTimeout(() => { overlay.style.display = 'none'; }, 1200); }, 3500);
            }
        }

        // --- MENU & MODAL FUNCTIONS ---
        function toggleMenu() { document.getElementById('main-menu').classList.toggle('show'); }
        window.addEventListener('click', (e) => {
            const menu = document.getElementById('main-menu');
            const btn = document.querySelector('.glass-menu-btn');
            if (!menu.contains(e.target) && !btn.contains(e.target)) menu.classList.remove('show');
        });

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
        }

        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        
        function openSettings() {
            document.getElementById('settings-user-name').innerText = `${userData.firstName} ${userData.lastName}`;
            
            const editUsed = localStorage.getItem('ah_edit_profile_used');
            const settingsWrapper = document.getElementById('settings-content-wrapper');
            const existingBtn = document.getElementById('btn-reset-profile');
            if(existingBtn) existingBtn.remove();

            if (!editUsed) {
                const btn = document.createElement('button');
                btn.id = 'btn-reset-profile';
                btn.className = 'btn-bubble w-full py-3 rounded-xl text-red-600 font-bold mt-2 text-sm';
                btn.innerText = 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª (ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø±)';
                btn.onclick = resetProfile;
                settingsWrapper.appendChild(btn);
            }
            document.getElementById('settings-modal').classList.add('open');
            document.getElementById('main-menu').classList.remove('show');
        }

        function resetProfile() {
            localStorage.removeItem('ah_user_fname');
            localStorage.removeItem('ah_user_lname');
            localStorage.setItem('ah_edit_profile_used', 'true');
            location.reload();
        }

        function openHistory() { document.getElementById('history-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); renderHistoryList(); }
        function openConverter() { document.getElementById('converter-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); }
        function openCurrency() { document.getElementById('currency-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); }
        function openDiscount() { document.getElementById('discount-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); }
        function openBMI() { document.getElementById('bmi-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); }
        function openPower() { document.getElementById('power-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); }
        function openAgeCalc() { document.getElementById('age-modal').classList.add('open'); document.getElementById('main-menu').classList.remove('show'); }

        function addToHistory(expression, result) {
            if (result === 'Error') return;
            calcHistory.unshift({ exp: expression, res: result });
            if (calcHistory.length > 10) calcHistory.pop(); 
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => { showToast('Ú©Ù¾ÛŒ Ø´Ø¯!'); }).catch(() => { showToast('Ú©Ù¾ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚'); });
        }
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2000);
        }

        function renderHistoryList() {
            const list = document.getElementById('history-list');
            if (calcHistory.length === 0) { list.innerHTML = '<div class="text-center text-gray-500 py-4">Ø®Ø§Ù„ÛŒ</div>'; return; }
            let html = '';
            calcHistory.forEach(item => {
                html += `<div class="glass-input p-3 rounded-xl mb-2 flex flex-col items-end cursor-pointer" onclick="copyToClipboard('${item.res}')"><span class="text-xs text-gray-500 font-mono">${item.exp}</span><span class="text-lg font-bold text-gray-800 font-mono dark:text-white">= ${item.res}</span></div>`;
            });
            list.innerHTML = html;
        }
        function clearHistory() { calcHistory = []; renderHistoryList(); }

        // --- CALC LOGIC ---
        const unitData = {
            length: [{val:'m',l:'Ù…ØªØ±',f:1},{val:'cm',l:'Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±',f:0.01},{val:'km',l:'Ú©ÛŒÙ„ÙˆÙ…ØªØ±',f:1000},{val:'inch',l:'Ø§ÛŒÙ†Ú†',f:0.0254},{val:'ft',l:'ÙÙˆØª',f:0.3048}],
            mass: [{val:'kg',l:'Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…',f:1000},{val:'g',l:'Ú¯Ø±Ù…',f:1},{val:'lb',l:'Ù¾ÙˆÙ†Ø¯',f:453.592},{val:'mesghal',l:'Ù…Ø«Ù‚Ø§Ù„',f:4.6083}],
            temp: [{val:'c',l:'Ø³Ù„Ø³ÛŒÙˆØ³'},{val:'f',l:'ÙØ§Ø±Ù†Ù‡Ø§ÛŒØª'}]
        };
        function updateConvOptions() {
            const type = document.getElementById('conv-type').value;
            const f = document.getElementById('conv-from'), t = document.getElementById('conv-to');
            const data = unitData[type];
            f.innerHTML = ''; t.innerHTML = '';
            data.forEach(u => { f.add(new Option(u.l, u.val)); t.add(new Option(u.l, u.val)); });
            t.selectedIndex = 1; convertUnits();
        }
        function convertUnits() {
            const val = parseFloat(document.getElementById('conv-input').value);
            const type = document.getElementById('conv-type').value;
            const f = document.getElementById('conv-from').value;
            const t = document.getElementById('conv-to').value;
            const res = document.getElementById('conv-result');
            if(isNaN(val)) { res.innerText = '0'; return; }
            let result;
            if(type === 'temp') {
                if(f===t) result=val;
                else if(f==='c') result=(val*1.8)+32;
                else result=(val-32)/1.8;
            } else {
                const uF = unitData[type].find(u=>u.val===f), uT = unitData[type].find(u=>u.val===t);
                result = (val * uF.f) / uT.f;
            }
            res.innerText = parseFloat(result.toFixed(4));
        }

        let currMode = 'usd-to-irr';
        function setCurrMode(mode) {
            currMode = mode;
            const b1 = document.getElementById('btn-usd-irr'), b2 = document.getElementById('btn-irr-usd');
            if(mode==='usd-to-irr') { 
                b1.className = "flex-1 py-2 rounded-full text-xs font-semibold shadow-inner bg-gray-200 text-gray-800"; 
                b2.className = "flex-1 py-2 rounded-full text-xs font-semibold text-gray-500 hover:bg-gray-100";
            } else {
                b2.className = "flex-1 py-2 rounded-full text-xs font-semibold shadow-inner bg-gray-200 text-gray-800"; 
                b1.className = "flex-1 py-2 rounded-full text-xs font-semibold text-gray-500 hover:bg-gray-100";
            }
            calcCurrency();
        }
        function calcCurrency() {
            const amt = parseFloat(document.getElementById('curr-input').value);
            const rate = parseFloat(document.getElementById('curr-rate').value);
            const res = document.getElementById('curr-result');
            if(isNaN(amt)||isNaN(rate)) { res.innerText='0'; return; }
            res.innerText = (currMode==='usd-to-irr') ? (amt*rate).toLocaleString() : (amt/rate).toFixed(2);
        }

        function calcDiscount() {
            const p = parseFloat(document.getElementById('disc-price').value), d = parseFloat(document.getElementById('disc-percent').value);
            const res = document.getElementById('disc-result');
            if(isNaN(p)||isNaN(d)) { res.innerText='---'; return; }
            const final = p - (p * d / 100);
            res.innerHTML = `Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: <span class="font-bold">${final.toLocaleString()}</span>`;
        }
        function calcBMI() {
            const h = parseFloat(document.getElementById('bmi-height').value)/100, w = parseFloat(document.getElementById('bmi-weight').value);
            const res = document.getElementById('bmi-result');
            if(isNaN(h)||isNaN(w)) { res.innerText='---'; return; }
            const bmi = w/(h*h);
            res.innerHTML = `<div class="text-2xl font-bold">${bmi.toFixed(1)}</div>`;
        }
        function calcPower() {
            const b = parseFloat(document.getElementById('pow-base').value), e = parseFloat(document.getElementById('pow-exp').value);
            if(!isNaN(b)&&!isNaN(e)) document.getElementById('pow-result').innerText = Math.pow(b,e);
        }
        function calcAge() {
            const d = document.getElementById('age-input').value;
            if(!d) return;
            const birth = new Date(d), now = new Date();
            if(birth>now) { document.getElementById('age-result').innerText = 'ØªØ§Ø±ÛŒØ® Ù†Ø§Ù…Ø¹ØªØ¨Ø±'; return; }
            let y = now.getFullYear() - birth.getFullYear();
            let m = now.getMonth() - birth.getMonth();
            let day = now.getDate() - birth.getDate();
            if(day<0) { m--; day+=30; }
            if(m<0) { y--; m+=12; }
            document.getElementById('age-result').innerText = `${y} Ø³Ø§Ù„ Ùˆ ${m} Ù…Ø§Ù‡ Ùˆ ${day} Ø±ÙˆØ²`;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-pill').forEach(b => {
                b.classList.remove('active');
                if(b.id===`tab-${tab}`) b.classList.add('active');
            });
            const c = document.getElementById('app-content');
            c.style.opacity='0';
            setTimeout(() => {
                c.innerHTML='';
                if(tab==='basic') { displayVal='0'; renderBasic(); }
                else if(tab==='fraction') renderFraction();
                else if(tab==='equation') renderEquation();
                else if(tab==='number') renderNumber();
                else if(tab==='polygon') renderPolygon();
                else if(tab==='sieve') renderSieve();
                c.style.opacity='1';
            }, 200);
        }

        function renderBasic() {
            document.getElementById('app-content').innerHTML = `
                <div class="flex flex-col h-full justify-end">
                    <div class="glass-input mb-5 text-right flex flex-col justify-center min-h-[5rem]">
                        <span class="text-3xl sm:text-4xl font-mono font-semibold text-gray-800 dark:text-gray-100 break-all tracking-tight" id="calc-display">${displayVal}</span>
                    </div>
                    <div class="grid grid-cols-4 gap-3">
                        <button onclick="inputParen('(')" class="btn-bubble btn-func h-16 w-full shadow-lg">(</button>
                        <button onclick="inputParen(')')" class="btn-bubble btn-func h-16 w-full shadow-lg">)</button>
                        <button onclick="handlePercent()" class="btn-bubble btn-func h-16 w-full shadow-lg">%</button>
                        <button onclick="handleSqrt()" class="btn-bubble btn-func h-16 w-full shadow-lg">âˆš</button>
                        <button onclick="handleClear()" class="btn-bubble btn-ac h-16 w-full shadow-lg">AC</button>
                        <button onclick="handleOp('/')" class="btn-bubble btn-op h-16 w-full shadow-lg">Ã·</button>
                        <button onclick="handleOp('*')" class="btn-bubble btn-op h-16 w-full shadow-lg">Ã—</button>
                        <button onclick="handleOp('-')" class="btn-bubble btn-op h-16 w-full shadow-lg">-</button>
                        <button onclick="inputDigit(7)" class="btn-bubble h-16 w-full text-2xl">7</button>
                        <button onclick="inputDigit(8)" class="btn-bubble h-16 w-full text-2xl">8</button>
                        <button onclick="inputDigit(9)" class="btn-bubble h-16 w-full text-2xl">9</button>
                        <button onclick="handleOp('+')" class="btn-bubble btn-op h-16 w-full shadow-lg">+</button>
                        <button onclick="inputDigit(4)" class="btn-bubble h-16 w-full text-2xl">4</button>
                        <button onclick="inputDigit(5)" class="btn-bubble h-16 w-full text-2xl">5</button>
                        <button onclick="inputDigit(6)" class="btn-bubble h-16 w-full text-2xl">6</button>
                        <button onclick="handleEqual()" class="btn-bubble btn-eq rounded-[2rem] text-3xl row-span-2 shadow-glow">=</button>
                        <button onclick="inputDigit(1)" class="btn-bubble h-16 w-full text-2xl">1</button>
                        <button onclick="inputDigit(2)" class="btn-bubble h-16 w-full text-2xl">2</button>
                        <button onclick="inputDigit(3)" class="btn-bubble h-16 w-full text-2xl">3</button>
                        <button onclick="inputDigit(0)" class="btn-bubble w-full col-span-2 rounded-full text-2xl h-16">0</button>
                        <button onclick="inputDot()" class="btn-bubble h-16 w-full text-2xl">.</button>
                    </div>
                </div>`;
        }

        function updateDisplay() { const d = document.getElementById('calc-display'); if(d) d.innerText = displayVal; }
        function inputDigit(n) { if(displayVal==='0'||displayVal==='Error') displayVal=String(n); else displayVal+=n; updateDisplay(); }
        function inputDot() { if(!displayVal.includes('.') || displayVal.match(/[+\-*/]/)) { displayVal+='.'; updateDisplay(); } }
        function inputParen(p) { if(displayVal==='0') displayVal=p; else displayVal+=p; updateDisplay(); }
        function handleOp(op) { displayVal+=op; updateDisplay(); }
        function handleClear() { displayVal='0'; updateDisplay(); }
        function handleSqrt() { try { displayVal = String(Math.sqrt(eval(displayVal)).toFixed(8)); } catch { displayVal='Error'; } updateDisplay(); }
        function handlePercent() { try { displayVal = String(eval(displayVal)/100); } catch { displayVal='Error'; } updateDisplay(); }
        function handleEqual() {
             if (displayVal === '1391') { document.body.style.animation = 'rainbow 2s infinite'; showToast('ğŸ‰ Easter Egg!'); displayVal='0'; updateDisplay(); return; }
             try { let res = eval(displayVal); displayVal = String(parseFloat(res.toFixed(8))); addToHistory(displayVal, displayVal); } catch { displayVal='Error'; } updateDisplay();
        }

        function gcd(a, b) { return b == 0 ? a : gcd(b, a % b); }
        function renderFraction() {
            document.getElementById('app-content').innerHTML = `
                <div class="flex flex-col gap-6 items-center pt-4">
                    <div class="glass-panel w-full p-6 flex flex-col items-center gap-4">
                        <div class="flex items-center gap-3 w-full justify-center" dir="ltr">
                            <div class="flex flex-col w-20"><input id="n1" class="glass-input text-center h-10 mb-1" placeholder="a"><input id="d1" class="glass-input text-center h-10" placeholder="b"></div>
                            <select id="frac-op" class="glass-input w-14 h-14 text-xl text-center"><option value="+">+</option><option value="-">-</option><option value="*">Ã—</option><option value="/">Ã·</option></select>
                            <div class="flex flex-col w-20"><input id="n2" class="glass-input text-center h-10 mb-1" placeholder="c"><input id="d2" class="glass-input text-center h-10" placeholder="d"></div>
                        </div>
                        <button onclick="calcFraction()" class="btn-bubble btn-eq w-full h-14 rounded-full text-xl mt-2">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    </div>
                    <div id="frac-result" class="glass-input w-full min-h-[8rem] rounded-[2.5rem] flex items-center justify-center p-4">...</div>
                </div>`;
        }
        function calcFraction() {
            const n1=parseFloat(document.getElementById('n1').value), d1=parseFloat(document.getElementById('d1').value);
            const n2=parseFloat(document.getElementById('n2').value), d2=parseFloat(document.getElementById('d2').value);
            const op=document.getElementById('frac-op').value;
            if(isNaN(n1)||isNaN(d1)||isNaN(n2)||isNaN(d2)) return;
            let rn, rd;
            if(op==='+'){ rn=n1*d2+n2*d1; rd=d1*d2; } else if(op==='-'){ rn=n1*d2-n2*d1; rd=d1*d2; }
            else if(op==='*'){ rn=n1*n2; rd=d1*d2; } else { rn=n1*d2; rd=d1*n2; }
            const c = gcd(Math.abs(rn), Math.abs(rd)); rn/=c; rd/=c;
            document.getElementById('frac-result').innerHTML = (rd===1)?`<span class="text-3xl font-bold">${rn}</span>`:`<div class="flex flex-col items-center"><span class="text-2xl font-bold">${rn}</span><div class="w-10 h-0.5 bg-gray-600 my-1"></div><span class="text-2xl font-bold">${rd}</span></div>`;
        }

        let eqMode = 'lin';
        function renderEquation() {
            document.getElementById('app-content').innerHTML = `
                 <div class="flex flex-col gap-4 pt-2">
                    <div class="glass-input p-1 rounded-full flex gap-1 border-none shadow-inner bg-transparent">
                         <button onclick="setEqMode('lin')" id="btn-lin" class="flex-1 py-2 rounded-full text-xs font-semibold shadow-inner bg-gray-200">Ø®Ø·ÛŒ</button>
                         <button onclick="setEqMode('frac')" id="btn-frac" class="flex-1 py-2 rounded-full text-xs font-semibold text-gray-500 hover:bg-gray-100">Ú©Ø³Ø±ÛŒ</button>
                         <button onclick="setEqMode('table')" id="btn-table" class="flex-1 py-2 rounded-full text-xs font-semibold text-gray-500 hover:bg-gray-100">Ø¬Ø¯ÙˆÙ„</button>
                    </div>
                    <div id="eq-inputs" class="glass-panel rounded-[2rem] p-6 flex flex-col gap-4 items-center"></div>
                    <button onclick="solveEq()" id="eq-btn" class="btn-bubble btn-eq w-full h-14 rounded-full text-xl font-semibold">Ø­Ù„</button>
                    <div id="eq-result" class="glass-input min-h-[4rem] rounded-[2rem] flex items-center justify-center p-4 text-center font-bold">...</div>
                 </div>`;
            setEqMode('lin');
        }
        function setEqMode(m) {
            eqMode=m; 
            ['lin','frac','table'].forEach(b=>{ document.getElementById(`btn-${b}`).className = (b===m)?"flex-1 py-2 rounded-full text-xs font-semibold shadow-inner bg-gray-200 text-gray-800":"flex-1 py-2 rounded-full text-xs font-semibold text-gray-500 hover:bg-gray-100"; });
            const c=document.getElementById('eq-inputs');
            if(m==='lin') c.innerHTML = `<div class="flex gap-2" dir="ltr"><input id="lin-a" class="glass-input w-12 text-center" placeholder="a">x+<input id="lin-b" class="glass-input w-12 text-center" placeholder="b">=<input id="lin-c" class="glass-input w-12 text-center" placeholder="c"></div>`;
            else if(m==='frac') c.innerHTML = `<div dir="ltr" class="flex items-center gap-2"><div class="flex flex-col"><div class="flex gap-1"><input id="f-a" class="glass-input w-8 text-center" placeholder="a">x+<input id="f-b" class="glass-input w-8 text-center" placeholder="b"></div><div class="h-px bg-gray-400 my-1"></div><div class="flex gap-1"><input id="f-c" class="glass-input w-8 text-center" placeholder="c">x+<input id="f-d" class="glass-input w-8 text-center" placeholder="d"></div></div>=<input id="f-e" class="glass-input w-12 text-center" placeholder="e"></div>`;
            else c.innerHTML = `<div class="flex gap-2 mb-2" dir="ltr">y=<input id="tbl-eq" class="glass-input flex-1 text-center" placeholder="2x+1"></div><div class="grid grid-cols-2 gap-2">${[0,1,2,3].map(i=>`<input id="tbl-x-${i}" class="glass-input text-center" placeholder="x"><input id="tbl-y-${i}" class="glass-input text-center" placeholder="y">`).join('')}</div>`;
        }
        function solveEq() {
            const r = document.getElementById('eq-result');
            if(eqMode==='lin') {
                const a=parseFloat(document.getElementById('lin-a').value), b=parseFloat(document.getElementById('lin-b').value), c=parseFloat(document.getElementById('lin-c').value);
                if(isNaN(a)||isNaN(b)||isNaN(c)){r.innerText='Ø®Ø·Ø§';return;}
                r.innerText = `x = ${((c-b)/a).toFixed(4)}`;
            } else if(eqMode==='table') {
                 // Simplified table logic placeholder
                 r.innerText = 'Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯ (Ù…Ù†Ø·Ù‚ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„)';
            } else {
                 // Frac logic
                 r.innerText = 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯ (Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„)';
            }
        }

        function renderNumber() {
            document.getElementById('app-content').innerHTML = `
                <div class="flex flex-col gap-6 pt-6 items-center">
                    <div class="glass-panel w-full p-8 rounded-[2rem] flex flex-col items-center">
                        <input id="num-input" type="number" class="glass-input w-full h-16 text-3xl text-center rounded-2xl" placeholder="Ø¹Ø¯Ø¯">
                    </div>
                    <button onclick="checkPrime()" class="btn-bubble btn-eq h-14 rounded-full text-xl font-semibold w-full">Ø¨Ø±Ø±Ø³ÛŒ</button>
                    <div id="num-result" class="glass-input w-full min-h-[10rem] rounded-[2rem] p-4 text-center">...</div>
                </div>`;
        }
        function checkPrime() {
             const n = parseInt(document.getElementById('num-input').value);
             if(!n) return;
             let isP = true; 
             if(n<2) isP=false;
             for(let i=2;i<=Math.sqrt(n);i++) if(n%i===0) isP=false;
             document.getElementById('num-result').innerHTML = `<span class="text-2xl font-bold ${isP?'text-green-600':'text-blue-600'}">${isP?'Ø§ÙˆÙ„ Ø§Ø³Øª':'Ù…Ø±Ú©Ø¨ Ø§Ø³Øª'}</span>`;
        }

        function renderPolygon() {
             document.getElementById('app-content').innerHTML = `
                <div class="flex flex-col gap-6 pt-6 items-center">
                    <div class="glass-panel w-full p-8 rounded-[2rem] flex flex-col items-center">
                        <input id="poly-input" type="number" class="glass-input w-full h-16 text-3xl text-center rounded-2xl" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¶Ù„Ø§Ø¹">
                    </div>
                    <button onclick="calcPoly()" class="btn-bubble btn-eq h-14 rounded-full text-xl font-semibold w-full">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    <div id="poly-result" class="glass-input w-full min-h-[10rem] rounded-[2rem] p-4 text-center flex flex-col justify-center">...</div>
                </div>`;
        }
        function calcPoly() {
            const n = parseInt(document.getElementById('poly-input').value);
            if(!n || n<3) return;
            const sum = (n-2)*180;
            document.getElementById('poly-result').innerHTML = `<div>Ù…Ø¬Ù…ÙˆØ¹ Ø²ÙˆØ§ÛŒØ§: <b>${sum}</b></div><div>Ù‡Ø± Ø²Ø§ÙˆÛŒÙ‡: <b>${(sum/n).toFixed(2)}</b></div>`;
        }

        function renderSieve() {
            document.getElementById('app-content').innerHTML = `
                <div class="flex flex-col gap-6 pt-6 items-center">
                    <div class="glass-panel w-full p-6 rounded-[2rem] flex flex-col items-center gap-2">
                        <div class="flex gap-2 w-full"><input id="s-start" class="glass-input w-full text-center" placeholder="Ø§Ø²"><input id="s-end" class="glass-input w-full text-center" placeholder="ØªØ§"></div>
                    </div>
                    <button onclick="doSieve()" class="btn-bubble btn-eq h-14 rounded-full text-xl font-semibold w-full">ØºØ±Ø¨Ø§Ù„</button>
                    <div id="sieve-result" class="glass-input w-full min-h-[6rem] rounded-[2rem] p-4 text-sm break-all">...</div>
                </div>`;
        }
        function doSieve() {
            const s = parseInt(document.getElementById('s-start').value), e = parseInt(document.getElementById('s-end').value);
            if(!s||!e) return;
            let primes = [];
            for(let i=s; i<=e; i++) {
                let isP = true; if(i<2) isP=false;
                for(let j=2; j<=Math.sqrt(i); j++) if(i%j===0) isP=false;
                if(isP) primes.push(i);
            }
            document.getElementById('sieve-result').innerText = primes.join(', ');
        }
    </script>
</body>
</html>
